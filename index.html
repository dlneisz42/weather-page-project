<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes"> 
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Weather App</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico"> 
    <link rel="apple-touch-icon" href="images/apple-touch-icon-iphone60x60.png"> 
    <link rel="apple-touch-icon" sizes="60x60" href="images/apple-touchicon-ipad-76x76.png"> 
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touchicon-iphone-retina-120x120.png"> 
    <link rel="apple-touch-icon" sizes="144x144" href="images/apple-touchicon-ipad-retina-152x152.png">
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/pulse/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="container mt-5">
    <div id="weather-container" class="mt-3">Loading weather...</div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const weatherContainer = document.getElementById("weather-container");

            async function fetchMeteoWeather(latitude, longitude, city, region) {
                try {
                    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,wind_speed_10m&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,precipitation&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP Error Status: ${response.status}`);
                    }

                    const data = await response.json();
                    console.log(data);

                    // Display data in the container
                    weatherContainer.innerHTML = `
                        <div class="card p-4 shadow-lg">
                            <h2 class="mb-3">Current Weather for ${city}, ${region}:</h2>
                            <p><i class="bi bi-thermometer"></i> Temperature: ${data.current.temperature_2m}°F</p>
                            <p><i class="bi bi-droplet"></i> Humidity: ${data.current.relative_humidity_2m}%</p>
                            <p><i class="bi bi-thermometer-half"></i> Feels Like: ${data.current.apparent_temperature}°F</p>
                            <p><i class="bi bi-cloud-rain"></i> Precipitation: ${data.current.precipitation} in</p>
                            <p><i class="bi bi-wind"></i> Wind Speed: ${data.current.wind_speed_10m} mph</p>
                            <button class="btn btn-primary mt-3" onclick="location.reload()">Refresh</button>
                        </div>`;
                } catch (error) {
                    console.log('Error fetching data:', error);
                    weatherContainer.innerHTML = `<p class="text-danger">Failed to fetch weather data.</p>`;
                }
            }

            function getGeolocation() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => fetchMeteoWeather(position.coords.latitude, position.coords.longitude),
                        () => {
                            fetch("https://ipapi.co/json/")
                                .then(response => response.json())
                                .then(data => fetchMeteoWeather(data.latitude, data.longitude, data.city, data.region))
                                .catch(() => {
                                    weatherContainer.innerHTML = `<p class="text-danger">Could not determine location.</p>`;
                                });
                        }
                    );
                } else {
                    weatherContainer.innerHTML = `<p class="text-danger">Geolocation is not supported by this browser.</p>`;
                }
            }

            getGeolocation();
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
