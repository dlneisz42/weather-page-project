<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes"> 
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Weather App</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico"> 
    <link rel="apple-touch-icon" href="images/icon.svg"> 
    <link rel="apple-touch-icon" sizes="60x60" href="images/icon.svg"> 
    <link rel="apple-touch-icon" sizes="114x114" href="images/icon.svg"> 
    <link rel="apple-touch-icon" sizes="144x144" href="images/icon.svg">
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/pulse/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body class="container mt-5" style="background-color: lightblue">
    <div id="weather-container" class="mt-3">Loading weather...</div>
    <button class="btn btn-primary" onclick="location.reload()" 
    style="position: absolute; top: 20px; right: 20px; z-index: 1000; padding: 10px 20px; font-size: 1.2rem; border-radius: 10px;">
    <i class="bi bi-arrow-clockwise fs-3"></i> Refresh
    </button>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const weatherContainer = document.getElementById("weather-container");
            async function fetchMeteoWeather(latitude, longitude, city, region) {
                try {
                    //const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,wind_speed_10m&hourly=temperature_2m,relative_humidity_2m,precipitation_probability,precipitation&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch`);
                    const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max,wind_speed_10m_max&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&timezone=auto`);
                    if (!response.ok) {
                        throw new Error(`HTTP Error Status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log(data);
                    weatherContainer.innerHTML = `
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="card col-12 mt-2 mb-4 shadow-lg" style="border-radius: 10px">
                                <h2 class="mt-3 mb-3">Current Weather for ${city}, ${region}:</h2>
                                <p><i class="bi bi-thermometer"></i> Temperature: ${data.current.temperature_2m}°F</p>
                                <p><i class="bi bi-droplet"></i> Humidity: ${data.current.relative_humidity_2m}%</p>
                                <p><i class="bi bi-thermometer-half"></i> Feels Like: ${data.current.apparent_temperature}°F</p>
                                <p><i class="bi bi-cloud-rain"></i> Precipitation: ${data.current.precipitation} in</p>
                                <p><i class="bi bi-wind"></i> Wind Speed: ${data.current.wind_speed_10m} mph</p>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-center align-items-center">
                            <div class="card col-12 mt-2 shadow-lg" style="border-radius: 10px">
                                <h2 class="mt-3 mb-3">Daily Forecast for ${city}, ${region}:</h2>`;
                } catch (error) {
                    console.log('Error fetching data:', error);
                    weatherContainer.innerHTML = `<p class="text-danger">Failed to fetch weather data.</p>`;
                }
            }

    function fetchGeolocation() {
        if (!navigator.geolocation) {
            console.error("Geolocation is not supported by this browser.");
            return;
        }
        navigator.geolocation.getCurrentPosition(
            async (position) => {
                const { latitude, longitude } = position.coords;
                try {
                    const response = await fetch(`https://ipapi.co/json/`);
                    if (!response.ok) throw new Error("Failed to fetch location data");
                    
                    const data = await response.json();
                    const { city, region } = data;
                    
                    fetchMeteoWeather(latitude, longitude, city, region);
                } catch (error) {
                    console.error("Error fetching location data:", error);
                }
            },
            (error) => {
                console.error("Error getting geolocation:", error.message);
            }
        );
    }
    fetchGeolocation();
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
<footer>
    <p>Uses the MeteoWeather API available at open-meteo.com.</p>
</footer>
</html>
